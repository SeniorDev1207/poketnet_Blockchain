(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([[10],{520:function(e,t,s){"use strict";s.r(t);s.d(t,"P2pMediaLoaderPlugin",function(){return f});var i=s(0);var r=s.n(i);var a=s(516);var n=s(220);var o=s(4);var l=s(330);var h=s.n(l);const d=function(s){if(!h.a.isSupported()){console.warn("Hls.js is not supported in this browser!");return}const e=s.getTech("Html5");if(!e){console.error("Not supported version if video.js");return}e.registerSourceHandler({canHandleSource:function(e){const t=/^application\/x-mpegURL|application\/vnd\.apple\.mpegurl$/i;const s=/\.m3u8/i;if(t.test(e.type))return"probably";if(s.test(e.src))return"maybe";return""},handleSource:function(e,t){if(t.hlsProvider){t.hlsProvider.dispose()}t.hlsProvider=new p(s,e,t);return t.hlsProvider}},0);s.Html5Hlsjs=p};function u(e){const t=this;if(!e)return;if(!t.srOptions_){t.srOptions_={}}if(!t.srOptions_.hlsjsConfig){t.srOptions_.hlsjsConfig=e.hlsjsConfig}if(!t.srOptions_.captionConfig){t.srOptions_.captionConfig=e.captionConfig}if(e.levelLabelHandler&&!t.srOptions_.levelLabelHandler){t.srOptions_.levelLabelHandler=e.levelLabelHandler}}const c=function(e){const t=e.registerPlugin||e.plugin;t("hlsjs",u)};class p{constructor(e,t,s){this.errorCounts={};this.hlsjsConfig=null;this._duration=null;this.metadata=null;this.isLive=null;this.dvrDuration=null;this.edgeMargin=null;this.handlers={play:null,playing:null,textTracksChange:null,audioTracksChange:null};this.uiTextTrackHandled=false;this.vjs=e;this.source=t;this.tech=s;this.tech.name_="Hlsjs";this.videoElement=s.el();this.player=e(s.options_.playerId);this.videoElement.addEventListener("error",e=>{let t;const s=(e.currentTarget||e.target).error;if(!s)return;switch(s.code){case s.MEDIA_ERR_ABORTED:t="You aborted the video playback";break;case s.MEDIA_ERR_DECODE:t="The video playback was aborted due to a corruption problem or because the video used features your browser did not support";this._handleMediaError(s);break;case s.MEDIA_ERR_NETWORK:t="A network error caused the video download to fail part-way";break;case s.MEDIA_ERR_SRC_NOT_SUPPORTED:t="The video could not be loaded, either because the server or network failed or because the format is not supported";break;default:t=s.message}});this.initialize()}duration(){return this._duration||this.videoElement.duration||0}seekable(){if(this.hls.media){if(!this.isLive){return this.vjs.createTimeRanges(0,this.hls.media.duration)}const e=Math.round(this.hls.media.duration-this.dvrDuration);const t=Math.round(this.hls.media.duration-this.edgeMargin);return this.vjs.createTimeRanges(e,t)}return this.vjs.createTimeRanges()}dispose(){this.videoElement.removeEventListener("play",this.handlers.play);this.videoElement.removeEventListener("playing",this.handlers.playing);this.player.textTracks().removeEventListener("change",this.handlers.textTracksChange);this.uiTextTrackHandled=false;this.hls.destroy()}static addHook(e,t){p.hooks[e]=this.hooks[e]||[];p.hooks[e].push(t)}static removeHook(e,t){if(p.hooks[e]===undefined)return false;const s=p.hooks[e].indexOf(t);if(s===-1)return false;p.hooks[e].splice(s,1);return true}_executeHooksFor(t){if(p.hooks[t]===undefined){return}for(let e=0;e<p.hooks[t].length;e++){p.hooks[t][e](this.player,this.hls)}}_handleMediaError(e){if(this.errorCounts[l["ErrorTypes"].MEDIA_ERROR]===1){console.info("trying to recover media error");this.hls.recoverMediaError();return}if(this.errorCounts[l["ErrorTypes"].MEDIA_ERROR]===2){console.info("2nd try to recover media error (by swapping audio codec");this.hls.swapAudioCodec();this.hls.recoverMediaError();return}if(this.errorCounts[l["ErrorTypes"].MEDIA_ERROR]>2){console.info("bubbling media error up to VIDEOJS");this.hls.destroy();this.tech.error=()=>e;this.tech.trigger("error");return}}_handleNetworkError(e){setTimeout(()=>this.hls.startLoad(),1e3);return;if(this.errorCounts[l["ErrorTypes"].NETWORK_ERROR]<=1){console.info("trying to recover network error");setTimeout(()=>this.hls.startLoad(),1e3);this.hls.once(l["Events"].FRAG_LOADED,()=>{this.errorCounts[l["ErrorTypes"].NETWORK_ERROR]=0});return}console.info("bubbling network error up to VIDEOJS");this.hls.destroy();this.tech.error=()=>e;this.tech.trigger("error")}_onError(e,t){const s={message:`HLS.js error: ${t.type} - fatal: ${t.fatal} - ${t.details}`};if(this.errorCounts[t.type])this.errorCounts[t.type]+=1;else this.errorCounts[t.type]=1;if(!t.fatal)return;if(t.type===l["ErrorTypes"].NETWORK_ERROR){s.code=2;this._handleNetworkError(s)}else if(t.type===l["ErrorTypes"].MEDIA_ERROR&&t.details!=="manifestIncompatibleCodecsError"){s.code=3;this._handleMediaError(s)}else{this.hls.destroy();console.info("bubbling error up to VIDEOJS");this.tech.error=()=>s;this.tech.trigger("error")}}switchQuality(e){this.hls.nextLevel=e}_levelLabel(e){if(this.player.srOptions_.levelLabelHandler){return this.player.srOptions_.levelLabelHandler(e)}if(e.height)return e.height+"p";if(e.width)return Math.round(e.width*9/16)+"p";if(e.bitrate)return e.bitrate/1e3+"kbps";return 0}_relayQualityChange(t){let s=true;for(let e=0;e<t.length;e++){if(!t[e]._enabled){s=false;break}}if(s){this.hls.currentLevel=-1;return}let e;for(e=t.length-1;e>=0;e--){if(t[e]._enabled){break}}this.hls.currentLevel=e}_handleQualityLevels(){if(!this.metadata)return;const t=this.player.qualityLevels&&this.player.qualityLevels();if(!t)return;for(let e=0;e<this.metadata.levels.length;e++){const s=this.metadata.levels[e];const i={id:e,width:s.width,height:s.height,bandwidth:s.bitrate,bitrate:s.bitrate,_enabled:true};const r=this;i.enabled=function(e,t){if(typeof t==="boolean"){this[e]._enabled=t;r._relayQualityChange(this)}return this[e]._enabled};t.addQualityLevel(i)}}_notifyVideoQualities(){if(!this.metadata)return;const i=[];if(this.metadata.levels.length>1){const t={id:-1,label:"auto",selected:this.hls.manualLevel===-1};i.push(t)}this.metadata.levels.forEach((e,t)=>{const s={id:t,selected:t===this.hls.manualLevel,label:this._levelLabel(e)};i.push(s)});const e={qualityData:{video:i},qualitySwitchCallback:this.switchQuality.bind(this)};this.tech.trigger("loadedqualitydata",e);this.videoElement.removeEventListener("playing",this.handlers.playing)}_updateSelectedAudioTrack(){const t=this.tech.audioTracks();for(let e=0;e<t.length;e++){if(t[e].enabled){this.hls.audioTrack=e;break}}}_onAudioTracks(){const t=this.hls.audioTracks;const s=this.tech.audioTracks();if(t.length>1&&s.length===0){for(let e=0;e<t.length;e++){s.addTrack(new this.vjs.AudioTrack({id:e.toString(),kind:"alternative",label:t[e].name||t[e].lang,language:t[e].lang,enabled:e===this.hls.audioTrack}))}this.handlers.audioTracksChange=this._updateSelectedAudioTrack.bind(this);s.addEventListener("change",this.handlers.audioTracksChange)}}_getTextTrackLabel(e){return e.label?e.label:e.language}_isSameTextTrack(e,t){return this._getTextTrackLabel(e)===this._getTextTrackLabel(t)&&e.kind===t.kind}_updateSelectedTextTrack(){const t=this.player.textTracks();let s=null;for(let e=0;e<t.length;e++){if(t[e].mode==="showing"){s=t[e];break}}const i=this.videoElement.textTracks;for(let e=0;e<i.length;e++){if(i[e].kind==="subtitles"||i[e].kind==="captions"){i[e].mode=s&&this._isSameTextTrack(i[e],s)?"showing":"disabled"}}}_startLoad(){this.hls.startLoad(-1);this.videoElement.removeEventListener("play",this.handlers.play)}_oneLevelObjClone(t){const s={};const i=Object.keys(t);for(let e=0;e<i.length;e++){s[i[e]]=t[i[e]]}return s}_filterDisplayableTextTracks(t){const s=[];for(let e=0;e<t.length;e++){if(t[e].kind==="subtitles"||t[e].kind==="captions"){s.push(t[e])}}return s}_updateTextTrackList(){const i=this._filterDisplayableTextTracks(this.videoElement.textTracks);const r=this.player.textTracks();for(let s=0;s<i.length;s++){let t=false;for(let e=0;e<r.length;e++){if(this._isSameTextTrack(i[s],r[e])){t=true;break}}if(!t){const e=i[s];this.player.addRemoteTextTrack({kind:e.kind,label:this._getTextTrackLabel(e),language:e.language,srclang:e.language},false)}}this._updateSelectedTextTrack();if(!this.uiTextTrackHandled){this.handlers.textTracksChange=this._updateSelectedTextTrack.bind(this);r.addEventListener("change",this.handlers.textTracksChange);this.uiTextTrackHandled=true}}_onMetaData(e,t){this.metadata=t;this._handleQualityLevels()}_createCueHandler(d){return{newCue:(t,s,i,r)=>{let a;let n;let o;const l=window.VTTCue||window.TextTrackCue;for(let e=0;e<r.rows.length;e++){a=r.rows[e];o="";if(!a.isEmpty()){for(let e=0;e<a.chars.length;e++){o+=a.chars[e].ucharj}n=new l(s,i,o.trim());if(d!=null&&typeof d==="object"){const h=Object.keys(d);for(let e=0;e<h.length;e++){n[h[e]]=d[h[e]]}}t.addCue(n);if(i===s)t.addCue(new l(i+5,""))}}}}}_initHlsjs(){const e=this.tech.options_;const t=this.player.srOptions_;const s=t&&t.hlsjsConfig||e.hlsjsConfig;this.hlsjsConfig=s?this._oneLevelObjClone(s):{};if(["","auto"].includes(this.videoElement.preload)&&!this.videoElement.autoplay&&this.hlsjsConfig.autoStartLoad===undefined){this.hlsjsConfig.autoStartLoad=false}const i=t&&t.captionConfig||e.captionConfig;if(i){this.hlsjsConfig.cueHandler=this._createCueHandler(i)}if(this.hlsjsConfig.autoStartLoad===false){this.handlers.play=this._startLoad.bind(this);this.videoElement.addEventListener("play",this.handlers.play)}var r;this.handlers.playing=this._notifyVideoQualities.bind(this);this.videoElement.addEventListener("playing",this.handlers.playing);this.hlsjsConfig.maxBufferHole=.5;this.hlsjsConfig.maxFragLookUpTolerance=0;this.hlsjsConfig.highBufferWatchdogPeriod=1;this.hlsjsConfig.lowLatencyMode=true;this.hlsjsConfig.maxBufferLength=30;this.hlsjsConfig.maxMaxBufferLength=55;this.hls=new h.a(this.hlsjsConfig);this._executeHooksFor("beforeinitialize");this.hls.on(l["Events"].ERROR,(e,t)=>this._onError(e,t));this.hls.on(l["Events"].AUDIO_TRACKS_UPDATED,()=>this._onAudioTracks());this.hls.on(l["Events"].MANIFEST_PARSED,(e,t)=>this._onMetaData(e,t));this.hls.on(l["Events"].LEVEL_LOADED,(e,t)=>{if(this.hlsjsConfig.liveSyncDuration){this.edgeMargin=this.hlsjsConfig.liveSyncDuration}else if(this.hlsjsConfig.liveSyncDurationCount){this.edgeMargin=this.hlsjsConfig.liveSyncDurationCount*t.details.targetduration}this.isLive=t.details.live;this.dvrDuration=t.details.totalduration;this._duration=this.isLive?Infinity:t.details.totalduration});this.hls.once(l["Events"].FRAG_LOADED,()=>{this.tech.trigger("loadedmetadata")});this.hls.once(l["Events"].FRAG_BUFFERED,e=>{});this.hls.attachMedia(this.videoElement);this.hls.loadSource(this.source.src)}initialize(){this._initHlsjs()}}p.hooks={};c(r.a);d(r.a);const g=r.a.getPlugin("plugin");class f extends g{constructor(e,t){super(e);this.CONSTANTS={INFO_SCHEDULER:1e3};this.statsP2PBytes={pendingDownload:[],pendingUpload:[],numPeers:0,totalDownload:0,totalUpload:0};this.statsHTTPBytes={pendingDownload:[],pendingUpload:[],totalDownload:0,totalUpload:0};this.options=t;if(!r.a.Html5Hlsjs){console.warn("HLS.js does not seem to be supported. Try to fallback to built in HLS.");if(!e.canPlayType("application/vnd.apple.mpegurl")){const s="Cannot fallback to built-in HLS";console.warn(s);e.ready(()=>e.trigger("error",new Error(s)));return}}else{r.a.Html5Hlsjs.addHook("beforeinitialize",(e,t)=>{this.hlsjs=t});Object(a["initVideoJsContribHlsJsPlayer"])(e)}this.startTime=Object(o["i"])(t.startTime);e.src({type:t.type,src:t.src});e.ready(()=>{this.initializeCore();if(r.a.Html5Hlsjs){this.initializePlugin()}})}dispose(){if(this.hlsjs)this.hlsjs.destroy();if(this.p2pEngine)this.p2pEngine.destroy();clearInterval(this.networkInfoInterval)}getHLSJS(){return this.hlsjs}initializeCore(){this.player.one("play",()=>{this.player.addClass("vjs-has-big-play-button-clicked")});this.player.one("canplay",()=>{if(this.startTime){this.player.currentTime(this.startTime)}})}initializePlugin(){Object(a["initHlsJsPlayer"])(this.hlsjs);const e=this.player.tech(true).options_;this.p2pEngine=e.hlsjsConfig.loader.getEngine();this.hlsjs.on(l["Events"].LEVEL_SWITCHING,(e,t)=>{this.trigger("resolutionChange",{auto:this.hlsjs.autoLevelEnabled,resolutionId:t.height})});this.p2pEngine.on(n["a"].SegmentError,(e,t)=>{console.error("Segment error.",e,t);this.options.redundancyUrlManager.removeBySegmentUrl(e.requestUrl)});this.statsP2PBytes.numPeers=1+this.options.redundancyUrlManager.countBaseUrls();this.runStats()}runStats(){this.p2pEngine.on(n["a"].PieceBytesDownloaded,(e,t)=>{const s=e==="p2p"?this.statsP2PBytes:this.statsHTTPBytes;s.pendingDownload.push(t);s.totalDownload+=t});this.p2pEngine.on(n["a"].PieceBytesUploaded,(e,t)=>{const s=e==="p2p"?this.statsP2PBytes:this.statsHTTPBytes;s.pendingUpload.push(t);s.totalUpload+=t});this.p2pEngine.on(n["a"].PeerConnect,()=>this.statsP2PBytes.numPeers++);this.p2pEngine.on(n["a"].PeerClose,()=>this.statsP2PBytes.numPeers--);this.networkInfoInterval=setInterval(()=>{const e=this.arraySum(this.statsP2PBytes.pendingDownload);const t=this.arraySum(this.statsP2PBytes.pendingUpload);const s=this.arraySum(this.statsHTTPBytes.pendingDownload);const i=this.arraySum(this.statsHTTPBytes.pendingUpload);this.statsP2PBytes.pendingDownload=[];this.statsP2PBytes.pendingUpload=[];this.statsHTTPBytes.pendingDownload=[];this.statsHTTPBytes.pendingUpload=[];return this.player.trigger("p2pInfo",{source:"p2p-media-loader",http:{downloadSpeed:s,uploadSpeed:i,downloaded:this.statsHTTPBytes.totalDownload,uploaded:this.statsHTTPBytes.totalUpload},p2p:{downloadSpeed:e,uploadSpeed:t,numPeers:this.statsP2PBytes.numPeers,downloaded:this.statsP2PBytes.totalDownload,uploaded:this.statsP2PBytes.totalUpload}})},this.CONSTANTS.INFO_SCHEDULER)}arraySum(e){return e.reduce((e,t)=>e+t,0)}}r.a.registerPlugin("p2pMediaLoader",f)}}]);