<%

var c = share.renders.caption();
var m = share.renders.message();

if(typeof ed == 'undefined') ed = {}

if(share.address){

	var my = (user.address.value && share.address == user.address.value.toString('hex'))
	var subscribed = '';

	if(!my && user.address.value){

		var me = deep(app, 'platform.sdk.users.storage.' + user.address.value.toString('hex'))


		if (me && me.relation(share.address, 'subscribes')){
			subscribed = 'subscribed'
		}
	}

var view = 'post';

if(share.settings.v == 'a'){
	view = 'article'
}
var bigmessage = false;
var name = app.platform.api.name(share.address)

var metadisplay = function(){ %>

<div class="meta">
	<div class="metatable table">
		<div class="metadata">
			<div class="author">

				<div class="authorTable table">
					<div class="authorCell">
						<% if(!ed.authAction) {%>

							<a href="<%-app.platform.api.authorlink(share.address)%>">

						<% } %>

						<% var reputation = deep(app, 'platform.sdk.usersl.storage.'+share.address+'.reputation') || 0 %>
						
							<b><span><%-name || share.address %></span></b><% if(reputation) {%><sup><%-compressedNumber(reputation, 1)%></sup><% } %>

						<% if(!ed.authAction) {%>
							</a>
						<% } %>

						<% if(state && !my) { %> 

							<span class="sbtnxs">
								&middot; <span class="subscribeLabel asubscribe">Follow</span><span class="subscribedLabel aunsubscribe"><i class="far fa-check-circle"></i> Following</span>
							</span>

						<% } %>
					</div>
					<!--
					<% var c = deep(app, 'platform.sdk.usersl.storage.'+share.address+'.rc');

						if(c > 0) { %>

						<div class="svcCell tooltip" title="<%-deep(app, 'platform.sdk.usersl.storage.'+share.address+'.name') || share.address %> rescued <%- c %> people from the censored web">

							<div class="icon savecrossIcon">
								<div class="icn">
									<i class="fas fa-plus-circle"></i>
								</div>
								<div class="amount">
									<span><%- c || 0 %></span>
								</div>
							</div>

						</div>

					<% } %>-->

					
				</div>
			</div>
		
		</div>

		<% if(state) {%>

		<div class="metapanel">
			<div class="metapanelitem metmenu">
				<i class="fas fa-ellipsis-h"></i>
			</div>
		</div>

		<% } %>

		<!--

		<% if(state) {

			if(!my && mestate.reputation >= 20) { %>

				<div class="metapanel">
					<div class="metapanelitem complain">
						<i class="fas fa-ban"></i> <span class="workstation">Complain</span>
					</div>
				</div>

			<% } 

		} %> -->
	</div>					
</div>
	
<% }

%>

<% var arranges = {
	
	cm : function(){ %> 

		<% if(c) {

			c = filterXSS(clearScripts((findAndReplaceLink(c, true))))
		%>
			<div class="paddingWrapper">
				<div class="sharecaption canmark">
					<div>
						<%=emojione.toImage(nl2br(trimrn(c)))%>
					</div>
				</div>
			</div>

		<% } %>

		<% if(m) {

			m = (m)
			
			var nm = m;

			if(typeof all == 'undefined' || !all){

				nm = trimHtml(m, 750);

				if(nm != m){
					bigmessage = true;
				}
			}

			nm = share.renders.xssmessage(nm)

			
			

		%>
			<div class="paddingWrapper">
				<div class="message canmark">

					<%=emojione.toImage((clearScripts(((nm)))))%>

				</div>
			</div>

			<% if(bigmessage) {%>

				<div class="paddingWrapper showMorePW">
					<div class="showMore">
						<div class="showmoretable table">
							<div class="linecell">
								<div class="line"></div>
							</div>
							<div class="buttoncell">
								<button>
									Show More
								</button>
							</div>
							<div class="linecell">
								<div class="line"></div>
							</div>
						</div>
						

					</div>
				</div>

			<% } %>

		<% } %>
		
	<% },

	
	i : function(){ %> 
		<% if(share.images.length) {

				var icClass = '';
				var additionall = 0;
				var imageFromVideo = ''


				if(share.url && parseVideo(share.url).type){
					additionall++;
					imageFromVideo = videoImage(share.url)
				}

				if (share.images.length + additionall == 1) icClass = 'one';
				if (share.images.length + additionall == 2) icClass = 'two';
				if (share.images.length + additionall == 2) icClass = 'three';
				if (share.images.length + additionall == 4) icClass = 'four';
				if (share.images.length + additionall > 4) icClass = 'more';
				


				if(share.settings.v == 'a'){ 

					icClass = 'articleImages'

				%>

					<div class="imagecaption">
						Attached images:
					</div>

				<% } %>
 
				<div class="images">
					<div class="imagesContainer <%-icClass%>">
						<% _.each(share.images, function(image){ %>

							<div class="imagesWrapper">
								<div class="image imageOpen" image="<%-image%>" i="<%-image%>">
								</div>
							</div>

						<% }) %>

						<% if(imageFromVideo) {%>

							<div class="imagesWrapper forvideo">

								<div class="image videoOpen" image="<%-imageFromVideo%>">
									<div class="playicon"><i class="fas fa-play"></i></div>
								</div>

							</div>

						<% } %>
						
					</div>
				</div>

		<% } %>
	<% },

	u : function(){ %> 
		<% if(share.url) {

			var h = ''
			
			if(parseVideo(share.url).type && share.images.length){
				h = 'hiddenurl'
			}
			
			%>

			<div class="url <%-h%>">
			</div>

		<% } %>
	<% }

} %>

	<div class="work">

		<div class="shareTable  table <%-subscribed%> <%-view%>" address="<%-share.address%>">
			<div class="iconWrapper">


				<% if(!ed.authAction) {%>
				
					<a href="<%-app.platform.api.authorlink(share.address)%>">

				<% } %>

					<% var src = deep(app, 'platform.sdk.usersl.storage.'+share.address+'.image')  %>

					<div class="icon">
						<div class="usericon usericonsbsa another" image="<%-src || ''%>">
							<% if(!src) {%>
								<svg width="30" height="30" data-jdenticon-value="<%-share.address%>"></svg>
							<% } %>
						</div>
					</div>



				<% if(!ed.authAction) {%>
					</a>
				<% } %>

				<!--
				
				<% if(!my && state && !ed.byauthor) {%>

					<div class="additional">
						<i class="fas fa-plus"></i>
					</div>

				<% } %>

				<% if(!isMobile()) { %> 

					<% if(!share.temp) {%>

						<div class="aitem ashare sharesocial">
							<i class="fas fa-share-alt"></i>
						</div>

					<% } %>
				<% } %>-->



			</div>

			<% if(isMobile()) { %> 
				<div class="metawrapper"> 
					<% metadisplay() %> 
				</div> 
			<% } %>

			<div class="shareWrapper">

				<% if(!isMobile()) { metadisplay() } %>

				<div class="shareContent">


					<% var a = share.settings.a || share.default.a %>


						<% _.each(a, function(key, i){ %> 

							<% if(arranges[key]) arranges[key]() %>
									
						<% }) %>

					<div class="paddingWrapper">
						
						<% if(share.tags && share.tags.length > 0) {%>

							<div class="tags canmark">
								<% _.each(share.tags, function(tag){ %>

									<div class="tag">
										<a href="s?ss=tag:<%-tag%>">
											<span>
												#<%-tag%>
											</span>
										</a>
									</div>

								<% }) %>
							</div>

						<% } %>
						<!--
						<div class="sys">

							<div class="txid">
								<span><%-share.txid%></span>
							</div>						

						</div>-->

						<div class="sys">
							<% if(share.time) {%>

								<span><%- convertDate(dateToStr(share.time)) %></span>

							<% } else { %> 

								<span>New</span>

							<% } %>

							<% if(share.edit == 'true') {%>	
								<span class="editedLabel"><i class="fas fa-pencil-alt"></i> Edited</span>
							<% } %>
						</div>

						<% if(!share.temp) {%>
							<div class="panel">
								<div class="item forstars">

									
								</div>

								<div class="item sharesocial right">

									<div class="itemwr table">
										<div class="labelwr"><span class="label">SHARE</span></div>
										<div class="iconwr">
											
											<div class="icon">
												<i class="fas fa-share-alt"></i>
											</div>
										</div>
										
										
									</div>
									
								</div>

								<% if(my){ %> 

									<!--<div class="item promote ">

										<div class="itemwr table">
											<div class="iconwr">
												<div class="icon">
													<i class="fas fa-level-up-alt"></i>
												</div>
											</div>

											<div class="count">
												<span>PROMOTE</span>
											</div>
											
										</div>
										
									</div>-->


								<% } else { %> 

									<!--<div class="item donate right">

										<div class="itemwr table">
											<div class="iconwr">
												<div class="icon">
													<i class="fas fa-donate"></i>
												</div>
											</div>
											
											
										</div>
										
									</div>-->

								<% } %>

								<% if(state) {%>
								
									<!--<div class="item discussion">
										<div class="itemwr table">

											<div class="count">
												
											</div>

											<div class="iconwr">
												<div class="icon">
													<i class="fas fa-comments"></i>
												</div>												
											</div>

										</div>
									</div>-->

								<% } %>

								

								<!--<div class="clearfix"></div>-->

								
								<!--<div class="item right">

									<div class="itemwr table commentsAction">
										<div class="iconwr">
											<div class="icon">
												<i class="fas fa-comment"></i>
											</div>
										</div>

										<div class="count">
											<span><%- share.comments || "0" %></span>
										</div>
										
									</div>
									
								</div>-->
							</div>
						<% } %>

						<% if(share.temp) {%>

							<div class="panel">
								<div class="item right">

									<div class="itemwr table tempPreloader">
										
										<div class="iconwr">
											<div class="preloader5"><span></span><span></span><span></span></div>
										</div>
										
										<div class="count">
											<div class="label">

												<span><%=e('postWaitConf')%></span>
											</div>
										</div>

										
										
									</div>

								</div>
								<div class="clearfix"></div>
							</div>

						<% } %>

					</div>

				</div>

				

				<div class="subscribeWrapper">
					<div class="name">
						<span><b><%-deep(app, 'platform.sdk.usersl.storage.'+share.address+'.name') || share.address %></b></span>
					</div>

					<div class="subscribeevent">
						<div class="item">
							<button class="asubscribe">SUBSCRIBE
						</div>
						<!--
						<div class="item">
							<button class="asubscribePrivate">Private Subscribe <i class="fas fa-eye-slash"></i></button>
						</div>-->
					</div>

					<div class="unsubscribeevent">
						<div class="item">
							<button class="aunsubscribe">UNSUBSCRIBE</button>
						</div>
					</div>
				</div>
			</div>
		</div>

		<div class="blockAuthor">
			<div class="blockTable table">
				<div class="blockCell">
					<div class="label">You have blocked this User</div>
				</div>
			</div>
			
		</div>
		
	</div>
	<div class="commentsWrapperHb">
		
		<div class="commentsWrapper">
		</div>

	</div>

	<div class="exitFull roundclosebutton">
		<i class="fa fa-times" aria-hidden="true"></i>
	</div>

<% } %>